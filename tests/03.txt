E:\Workplace-Pycharm\signal-transceiver\.venv\Scripts\python.exe E:\Workplace-Pycharm\signal-transceiver\src\demo_run2.py 

╔══════════════════════════════════════════════════════════════════╗
║         Signal Transceiver - 远程 API 演示场景                    ║
║                                                                  ║
║  场景说明:                                                        ║
║  - 用户A: 数据提供者，每日北京时间 05:00 通过 API 远程上报数据      ║
║  - 用户B: 数据订阅者，每日北京时间 05:01 通过 API 远程拉取数据      ║
║                                                                  ║
║  前置条件: 服务器必须正在运行                                       ║
║  启动命令: uvicorn src.main:app --host 0.0.0.0 --port 8000       ║
╚══════════════════════════════════════════════════════════════════╝


============================================================
🔍 检查服务器状态
============================================================
   服务器状态: healthy
   版本: 1.0.0
   ✅ 服务器运行正常

============================================================
👤 设置用户账号
============================================================

📦 登录管理员账号（用于创建策略）...
   ✅ 管理员登录成功

📦 设置用户A（数据提供者 - trader1）...
   ✅ 用户A登录成功: trader1
   🔑 API Key: sk_eb581c31150dc3d841dbf7d957f...
   🔑 Client Key: ck_94ba7860715174146ae316884e056640

📦 设置用户B（数据订阅者 - subscriber1）...
   ✅ 用户B登录成功: subscriber1
   🔑 API Key: sk_eb880f7003ad7c05191ae9072e2...
   🔑 Client Key: ck_1d83e5257a871683bad9acfbce60162b

============================================================
📊 管理员创建策略S
============================================================
   ✅ 策略创建成功: strategy_s_remote
   📋 策略名称: 远程每日交易策略S
   📝 描述: 用户A的远程策略，每天北京时间5:00通过API发布数据

============================================================
🔔 用户B订阅策略S
============================================================
   ✅ 订阅创建成功: ID=6
   📋 订阅名称: 订阅-strategy_s_remote
   🔍 过滤条件: {'symbols': ['AAPL', 'GOOGL', 'TSLA'], 'signal_types': ['buy', 'sell']}

============================================================
🔄 开始模拟每日远程API工作流程
============================================================

============================================================
📅 第 1 天 - 2026-02-11
============================================================

⏰ 模拟北京时间 05:00 - 用户A远程上报数据

------------------------------------------------------------
📤 [用户A] 远程API上报数据
   ⏰ 北京时间: 2026-02-11 05:00:00
   🌐 API端点: POST http://127.0.0.1:8000/api/v1/data/
------------------------------------------------------------
   ✅ AAPL: BUY (置信度: 0.67)
   ✅ GOOGL: SELL (置信度: 0.71)
   ✅ MSFT: SELL (置信度: 0.85)
   ✅ TSLA: HOLD (置信度: 0.61)

   📊 成功上报 4/4 条数据

⏰ 模拟北京时间 05:01 - 用户B远程拉取数据

------------------------------------------------------------
📥 [用户B] 远程API拉取数据
   ⏰ 北京时间: 2026-02-11 20:07:33
   🌐 API端点: GET http://127.0.0.1:8000/api/v1/subscriptions/6/poll
------------------------------------------------------------
   📋 订阅ID: 6
   📊 获取到 4 条数据:
      📈 [2026-02-11] AAPL: BUY (置信度: 0.67)
      📈 [2026-02-11] GOOGL: SELL (置信度: 0.71)
      📈 [2026-02-11] MSFT: SELL (置信度: 0.85)
      📈 [2026-02-11] TSLA: HOLD (置信度: 0.61)

💤 等待下一天模拟...

============================================================
📅 第 2 天 - 2026-02-12
============================================================

⏰ 模拟北京时间 05:00 - 用户A远程上报数据

------------------------------------------------------------
📤 [用户A] 远程API上报数据
   ⏰ 北京时间: 2026-02-12 05:00:00
   🌐 API端点: POST http://127.0.0.1:8000/api/v1/data/
------------------------------------------------------------
   ✅ AAPL: HOLD (置信度: 0.94)
   ✅ GOOGL: BUY (置信度: 0.92)
   ✅ MSFT: SELL (置信度: 0.91)
   ✅ TSLA: BUY (置信度: 0.75)

   📊 成功上报 4/4 条数据

⏰ 模拟北京时间 05:01 - 用户B远程拉取数据

------------------------------------------------------------
📥 [用户B] 远程API拉取数据
   ⏰ 北京时间: 2026-02-11 20:07:36
   🌐 API端点: GET http://127.0.0.1:8000/api/v1/subscriptions/6/poll
------------------------------------------------------------
   📋 订阅ID: 6
   📊 获取到 0 条数据:

💤 等待下一天模拟...

============================================================
📅 第 3 天 - 2026-02-13
============================================================

⏰ 模拟北京时间 05:00 - 用户A远程上报数据

------------------------------------------------------------
📤 [用户A] 远程API上报数据
   ⏰ 北京时间: 2026-02-13 05:00:00
   🌐 API端点: POST http://127.0.0.1:8000/api/v1/data/
------------------------------------------------------------
   ✅ AAPL: BUY (置信度: 0.83)
   ✅ GOOGL: SELL (置信度: 0.63)
   ✅ MSFT: SELL (置信度: 0.66)
   ✅ TSLA: HOLD (置信度: 0.77)

   📊 成功上报 4/4 条数据

⏰ 模拟北京时间 05:01 - 用户B远程拉取数据

------------------------------------------------------------
📥 [用户B] 远程API拉取数据
   ⏰ 北京时间: 2026-02-11 20:07:39
   🌐 API端点: GET http://127.0.0.1:8000/api/v1/subscriptions/6/poll
------------------------------------------------------------
   📋 订阅ID: 6
   📊 获取到 0 条数据:

============================================================
📚 API 调用示例 (cURL)
============================================================

┌─────────────────────────────────────────────────────────────┐
│                    1. 用户登录                               │
└─────────────────────────────────────────────────────────────┘
curl -X POST "http://127.0.0.1:8000/api/v1/auth/login" \
  -H "Content-Type: application/json" \
  -d '{"username": "provider_a", "password": "password123"}'

┌─────────────────────────────────────────────────────────────┐
│                    2. 上报数据 (用户A)                        │
└─────────────────────────────────────────────────────────────┘
curl -X POST "http://127.0.0.1:8000/api/v1/data/" \
  -H "Content-Type: application/json" \
  -H "X-Client-Key: YOUR_CLIENT_KEY" \
  -H "X-Client-Secret: YOUR_CLIENT_SECRET" \
  -d '{
    "type": "trading_signal",
    "symbol": "AAPL",
    "execute_date": "2026-02-05",
    "description": "AAPL BUY signal",
    "payload": {"signal": "buy", "confidence": 0.85},
    "strategy_id": "strategy_s_remote"
  }'

┌─────────────────────────────────────────────────────────────┐
│                    3. 创建订阅 (用户B)                        │
└─────────────────────────────────────────────────────────────┘
curl -X POST "http://127.0.0.1:8000/api/v1/subscriptions/" \
  -H "Content-Type: application/json" \
  -H "X-Client-Key: YOUR_CLIENT_KEY" \
  -H "X-Client-Secret: YOUR_CLIENT_SECRET" \
  -d '{
    "name": "My Subscription",
    "strategy_id": "strategy_s_remote",
    "subscription_type": "polling",
    "filters": {"symbols": ["AAPL", "GOOGL"]}
  }'

┌─────────────────────────────────────────────────────────────┐
│                    4. 拉取数据 (用户B)                        │
└─────────────────────────────────────────────────────────────┘
curl -X GET "http://127.0.0.1:8000/api/v1/subscriptions/1/poll?since=2026-02-05T00:00:00" \
  -H "X-Client-Key: YOUR_CLIENT_KEY" \
  -H "X-Client-Secret: YOUR_CLIENT_SECRET"

# 或直接查询数据列表
curl -X GET "http://127.0.0.1:8000/api/v1/data/?strategy_id=strategy_s_remote" \
  -H "X-Client-Key: YOUR_CLIENT_KEY" \
  -H "X-Client-Secret: YOUR_CLIENT_SECRET"


============================================================
✅ 远程API演示完成！
============================================================

Process finished with exit code 0
